"use strict";var asyncHandler=require("express-async-handler"),AppError=require("../errors/AppError"),jwt=require("jsonwebtoken"),_require=require("util"),promisify=_require.promisify,User=require("../models/user"),UnauthorizedError=require("../errors/unAuthorized"),isAuth=asyncHandler(function(e,r,t){var n,s,o;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return e.headers.authorization&&e.headers.authorization.startsWith("Bearer")?n=e.headers.authorization.split(" ")[1]:e.cookies.jwt&&(n=e.cookies.jwt),n||t(new UnauthorizedError(" not found token",401)),r.next=4,regeneratorRuntime.awrap(promisify(jwt.verify)(n,process.env.SECRET_KEY));case 4:return s=r.sent,r.next=7,regeneratorRuntime.awrap(User.findById(s.userId));case 7:if((o=r.sent)||t(new UnauthorizedError(" the user is not exist",401)),o.changedPasswordAfter(s.iat))return r.abrupt("return",t(new UnauthorizedError("User Belong To This Token Recently Changed Password! Please Log In Again",401)));r.next=11;break;case 11:e.user=o,t();case 13:case"end":return r.stop()}})});module.exports=isAuth;
//# sourceMappingURL=isAuth.min.js.map
